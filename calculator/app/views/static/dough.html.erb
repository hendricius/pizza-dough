<div class="results-container">
  <div class="results-inner">
    <div class="title">
      <h1 class="dough-title">Your pizza dough ğŸ•</h1>
      <%= link_to root_path(@dough.extract_dough_parameters), class: "close" do %>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Back">
          <path d="M12 9.6L2.4 0L0 2.4L9.6 12L0 21.6L2.4 24L12 14.4L21.6 24L24 21.6L14.4 12L24 2.4L21.6 0L12 9.6Z" fill="white"></path>
        </svg>
      <% end %>
    </div>
    <div class="base-info first">
      <div class="left">Total pizzas:</div>
      <div class="right"><%= @dough.pizzas %></div>
    </div>
    <div class="base-info">
      <div class="left">Weight per pizza:</div>
      <div class="right">
        <%= number_with_delimiter(@dough.weight.to_i) %>g
      </div>
    </div>
    <div class="base-info">
      <div class="left">Total dough weight:</div>
      <div class="right">
        <%= number_with_delimiter((@dough.weight * @dough.pizzas).to_i) %>g
      </div>
    </div>
    <div class="base-info last">
      <div class="left">Dough type:</div>
      <div class="right">
        <%= @dough.dough_type_human %>
      </div>
    </div>
    <h1 class="dough-ingredients">Dough ingredients ğŸ</h1>
    <% @dough.ingredients.each do |ingredient| %>
      <div class="ingredient-wrapper">
        <div class="ingredient-base">
          <div class="ingredient-element"><%= ingredient.name %></div>
          <div class="ingredient-element number"><%= number_with_precision(ingredient.quantity_grams, precision: ingredient.precision) %>g</div>
          <div class="ingredient-element number"><%= number_to_percentage(ingredient.percentage * 100, precision: 2) %></div>
        </div>
        <% if ingredient.description %>
          <div class="ingredient-description">
            <%= ingredient.description.html_safe %>
          </div>
        <% end %>
      </div>
    <% end %>
    <% video_url = (@dough.dough_type == "yeast") ? "https://www.youtube.com/watch?v=l0nAMbbYziI" : "https://www.youtube.com/watch?v=-60DxtcJ9Fo" %>
    <div class="instructions instructions-cta">
      <h1>Make the dough next ğŸ“š</h1>
      <p>Your ingredients are calculated. Follow the steps below to mix, ferment, and bake.</p>
      <div class="cta-group">
        <div><a class="cta" href="https://breadco.de/pizza-text" target="_blank" rel="noopener">Read the full recipe Â»</a></div>
        <div><a class="cta" href="<%= video_url %>" target="_blank" rel="noopener">Watch the video Â»</a></div>
        <div><a class="cta primary" href="https://breadco.de/support" target="_blank" rel="noopener">Support & Buy me flour Â»</a></div>
        <div><a class="cta primary" href="https://breadco.de/hardcover-book" target="_blank" rel="noopener">Support & Buy my book Â»</a></div>
      </div>
    </div>
    <h1 class="dough-ingredients">Toppings guide ğŸ…ğŸ§€ğŸŒ¿</h1>
    <div class="base-info first">
      <div class="left">Mozzarella total:</div>
      <div class="right"><%= @dough.mozzarella_total %>g</div>
    </div>
    <div class="base-info">
      <div class="left">Tomato sauce total:</div>
      <div class="right"><%= @dough.sauce_total %>g</div>
    </div>
    <div class="base-info">
      <div class="left">Olive oil total:</div>
      <div class="right"><%= @dough.oil_total %>g</div>
    </div>
    <div class="base-info">
      <div class="left">Basil leaves total:</div>
      <div class="right"><%= @dough.basil_leaves_total %></div>
    </div>
    <div class="base-info last">
      <div class="left">Basil pots (est.):</div>
      <div class="right"><%= @dough.basil_pots_estimate %> (â‰ˆ <%= Dough::BASIL_LEAVES_PER_POT_DEFAULT %> leaves/pot)</div>
    </div>

    <div class="actions">
      <a class="action share" href="#">
        <span>
          Share dough
        </span>
        <%= image_tag "share.webp" %>
      </a>
      <a class="action print" href="#">
        <span>Print recipe</span>
        <span class="icon">ğŸ–¨ï¸</span>
      </a>
    </div>
  </div>
</div>

<script type="text/javascript">
  const shareData = {
    title: 'Pizza dough recipe',
    text: 'Check out this pizza dough recipe',
    url: window.location.href
  }

  const shareButton = document.querySelector('.share');
  shareButton.href = window.location.href;

  // Fallback to manual sharing for unsupported browsers
  const fallback = () => {
    const successful = document.execCommand('copy'); // Try copying to clipboard
    if (successful) {
      alert("Link copied to clipboard! You can now paste it.");
    } else {
      window.prompt("Copy this link manually:", window.location.href);
    }
  }

  shareButton.addEventListener('click', async (event) => {
    event.preventDefault();
    if (navigator.share) {
      try {
        await navigator.share(shareData);
      } catch (err) {
        console.error("Sharing failed", err); // Catch any errors that might occur
      }
    } else {
      fallback(); // Use fallback if Web Share API is not available
    }
  });

  // Print button handler
  const printButton = document.querySelector('.print');
  if (printButton) {
    printButton.addEventListener('click', (event) => {
      event.preventDefault();
      window.print();
    });
  }
</script>
